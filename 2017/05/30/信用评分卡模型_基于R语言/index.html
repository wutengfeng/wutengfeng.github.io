<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="机器学习项目,信用评分卡,R语言," />










<meta name="description" content="一、项目简述(一)项目目标基于WOE转换及逻辑回归模型制作一张反映贷款人信用风险水平的信用评分卡。 (二)数据来源数据来自Kaggle的cs-training.csv样本，该样本有15万条的个人消费类贷款数据。 数据下载地址 (三)数据说明变量名(原始)为文件中变量名，由于原始变量名较长，所以就转换成较短的y、x1、x2…代替。">
<meta property="og:type" content="article">
<meta property="og:title" content="信用评分卡模型_基于R语言">
<meta property="og:url" content="http://yoursite.com/2017/05/30/%E4%BF%A1%E7%94%A8%E8%AF%84%E5%88%86%E5%8D%A1%E6%A8%A1%E5%9E%8B_%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80/index.html">
<meta property="og:site_name" content="大枫的个人博客">
<meta property="og:description" content="一、项目简述(一)项目目标基于WOE转换及逻辑回归模型制作一张反映贷款人信用风险水平的信用评分卡。 (二)数据来源数据来自Kaggle的cs-training.csv样本，该样本有15万条的个人消费类贷款数据。 数据下载地址 (三)数据说明变量名(原始)为文件中变量名，由于原始变量名较长，所以就转换成较短的y、x1、x2…代替。">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6cd504f4bcb04ab569e.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6cd504f4bcb04ab56a0.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6cd504f4bcb04ab56a4.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6cd504f4bcb04ab56a7.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6ce504f4bcb04ab56aa.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6d4504f4bcb04ab5dda.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6d4504f4bcb04ab5ddd.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6d4504f4bcb04ab5ddf.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6d4504f4bcb04ab5de8.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6d4504f4bcb04ab5deb.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6db504f4bcb04ab64ab.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6db504f4bcb04ab649b.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6db504f4bcb04ab649e.png">
<meta property="og:image" content="https://pic.downk.cc/item/5e86e6db504f4bcb04ab64a3.png">
<meta property="article:published_time" content="2017-05-30T03:57:17.000Z">
<meta property="article:modified_time" content="2020-04-03T08:32:35.826Z">
<meta property="article:author" content="大枫">
<meta property="article:tag" content="机器学习项目">
<meta property="article:tag" content="信用评分卡">
<meta property="article:tag" content="R语言">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.downk.cc/item/5e86e6cd504f4bcb04ab569e.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/05/30/信用评分卡模型_基于R语言/"/>





  <title>信用评分卡模型_基于R语言 | 大枫的个人博客</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?86773429461bd9f404e524d58c7b14ec";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">大枫的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">这是最好的时代，也是最坏的时代</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/30/%E4%BF%A1%E7%94%A8%E8%AF%84%E5%88%86%E5%8D%A1%E6%A8%A1%E5%9E%8B_%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大枫">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大枫的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">信用评分卡模型_基于R语言</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-30T11:57:17+08:00">
                2017-05-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="一、项目简述"><a href="#一、项目简述" class="headerlink" title="一、项目简述"></a>一、项目简述</h2><h3 id="一-项目目标"><a href="#一-项目目标" class="headerlink" title="(一)项目目标"></a>(一)项目目标</h3><p>基于WOE转换及逻辑回归模型制作一张反映贷款人信用风险水平的信用评分卡。</p>
<h3 id="二-数据来源"><a href="#二-数据来源" class="headerlink" title="(二)数据来源"></a>(二)数据来源</h3><p>数据来自Kaggle的cs-training.csv样本，该样本有15万条的个人消费类贷款数据。 <a href="https://www.kaggle.com/c/GiveMeSomeCredit/data" target="_blank" rel="noopener">数据下载地址</a></p>
<h3 id="三-数据说明"><a href="#三-数据说明" class="headerlink" title="(三)数据说明"></a>(三)数据说明</h3><p>变量名(原始)为文件中变量名，由于原始变量名较长，所以就转换成较短的y、x1、x2…代替。</p>
<a id="more"></a>

<table>
<thead>
<tr>
<th align="left">变量名(原始)</th>
<th align="center">变量名</th>
<th align="center">变量类型</th>
<th align="left">变量描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="center">id</td>
<td align="center">integer</td>
<td align="left">序号</td>
</tr>
<tr>
<td align="left">SeriousDlqin2yrs</td>
<td align="center">y</td>
<td align="center">Y/N</td>
<td align="left">超过90天或更糟的逾期拖欠</td>
</tr>
<tr>
<td align="left">RevolvingUtilizationOfUnsecuredLines</td>
<td align="center">x1</td>
<td align="center">percentage</td>
<td align="left">无担保放款的循环利用：除了不动产和像车贷那样除以信用额度总和的无分期付款债务的信用卡和个人信用额度总额</td>
</tr>
<tr>
<td align="left">age</td>
<td align="center">x2</td>
<td align="center">integer</td>
<td align="left">借款人当时的年龄</td>
</tr>
<tr>
<td align="left">NumberOfTime30-59DaysPastDueNotWorse</td>
<td align="center">x3</td>
<td align="center">integer</td>
<td align="left">35-59天逾期但不糟糕次数</td>
</tr>
<tr>
<td align="left">DebtRatio</td>
<td align="center">x4</td>
<td align="center">percentage</td>
<td align="left">负债比率</td>
</tr>
<tr>
<td align="left">MonthlyIncome</td>
<td align="center">x5</td>
<td align="center">real</td>
<td align="left">月收入</td>
</tr>
<tr>
<td align="left">NumberOfOpenCreditLinesAndLoans</td>
<td align="center">x6</td>
<td align="center">integer</td>
<td align="left">开放式信贷和贷款数量，开放式贷款（分期付款如汽车贷款或抵押贷款）和信贷（如信用卡）的数量</td>
</tr>
<tr>
<td align="left">NumberOfTimes90DaysLate</td>
<td align="center">x7</td>
<td align="center">integer</td>
<td align="left">90天逾期次数：借款者有90天或更高逾期的次数</td>
</tr>
<tr>
<td align="left">NumberRealEstateLoansOrLines</td>
<td align="center">x8</td>
<td align="center">integer</td>
<td align="left">不动产贷款或额度数量：抵押贷款和不动产放款包括房屋净值信贷额度</td>
</tr>
<tr>
<td align="left">NumberOfTime60-89DaysPastDueNotWorse</td>
<td align="center">x9</td>
<td align="center">integer</td>
<td align="left">60-89天逾期但不糟糕次数：借款人在在过去两年内有60-89天逾期还款但不糟糕的次数</td>
</tr>
<tr>
<td align="left">NumberOfDependents</td>
<td align="center">x10</td>
<td align="center">integer</td>
<td align="left">家属数量：不包括本人在内的家属数量</td>
</tr>
</tbody></table>
<h2 id="二、建模过程"><a href="#二、建模过程" class="headerlink" title="二、建模过程"></a>二、建模过程</h2><h3 id="一-数据读入及重命名"><a href="#一-数据读入及重命名" class="headerlink" title="(一)数据读入及重命名"></a>(一)数据读入及重命名</h3><pre><code>#读入训练数据集
traindata&lt;-read.csv(&quot;cs-training.csv&quot;,header = TRUE)
#原始变量名太长,重命名
names(traindata)=c(&quot;id&quot;,&quot;y&quot;,&quot;x1&quot;,&quot;x2&quot;,&quot;x3&quot;,&quot;x4&quot;,&quot;x5&quot;,&quot;x6&quot;,&quot;x7&quot;,&quot;x8&quot;,&quot;x9&quot;,&quot;x10&quot;)
#查看前6行数据,检查变量名是否更新完成
head(traindata)</code></pre><p>得到下面的结果，可以看到，变量名已经更新完成</p>
<pre><code>&gt; head(traindata)
  id y        x1 x2 x3         x4    x5 x6 x7 x8 x9 x10
1  1 1 0.7661266 45  2 0.80298213  9120 13  0  6  0   2
2  2 0 0.9571510 40  0 0.12187620  2600  4  0  0  0   1
3  3 0 0.6581801 38  1 0.08511338  3042  2  1  0  0   0
4  4 0 0.2338098 30  0 0.03604968  3300  5  0  0  0   0
5  5 0 0.9072394 49  1 0.02492570 63588  7  0  1  0   0
6  6 0 0.2131787 74  0 0.37560697  3500  3  0  1  0   1</code></pre><h3 id="二-缺失值处理"><a href="#二-缺失值处理" class="headerlink" title="(二)缺失值处理"></a>(二)缺失值处理</h3><pre><code>library(VIM)
matrixplot(traindata)    </code></pre><p>VIM包中的matrixplot可以把缺失值的分布展示出来，下图中浅色表示值比较小，深色表示值比较大，而红色表示缺失值。<br><img src="https://pic.downk.cc/item/5e86e6cd504f4bcb04ab569e.png" alt=""></p>
<pre><code>library(mice)
md.pattern(traindata)</code></pre><p>mice包中的md.pattern可以按变量统计缺失值个数，最后一行数字表示所在列变量的缺失值个数，可以看到变量x5和x10包含缺失值。(x5:月收入；x10:家属数量)</p>
<pre><code>&gt; md.pattern(traindata)
       id y x1 x2 x3 x4 x6 x7 x8 x9  x10    x5      
120269  1 1  1  1  1  1  1  1  1  1    1     1     0
 25807  1 1  1  1  1  1  1  1  1  1    1     0     1
  3924  1 1  1  1  1  1  1  1  1  1    0     0     2
        0 0  0  0  0  0  0  0  0  0 3924 29731 33655</code></pre><p>上述x5和x10变量缺失值占比较高，直接移除会损失较多数据，所以这里我们采用多重插补的方法对缺失值进行填补。</p>
<pre><code>imp&lt;-mice(traindata,met=&quot;cart&quot;,m=1)#该方法只对数值变量进行插补，分类变量的缺失值保留
traindata_imp&lt;-complete(imp)</code></pre><p>此外也可以用DMwR包中的knnImputation()进行缺失值填补，不过速度较慢，代码如下</p>
<pre><code>traindata&lt;-knnImputation(traindata,k=5,meth = &quot;median&quot;)</code></pre><p>填补完缺失值后再次调用md.pattern,可以看到已经没有缺失值了。</p>
<pre><code>&gt; md.pattern(traindata_imp)
     id y x1 x2 x3 x4 x5 x6 x7 x8 x9 x10  
[1,]  1 1  1  1  1  1  1  1  1  1  1   1 0
[2,]  0 0  0  0  0  0  0  0  0  0  0   0 0</code></pre><h3 id="三-异常值处理"><a href="#三-异常值处理" class="headerlink" title="(三)异常值处理"></a>(三)异常值处理</h3><p>分别对x2～x10进行异常值检验，一般来说异常值需要结合业务知识来将不符合业务尝试的数据剔除掉，这就要求建模人员熟悉每个变量的数据生产口径，同时也要掌握基本的异常值检测技术。</p>
<p>x2变量为‘借款人当时的年龄’，通过下面的语句发现年龄中包含0岁的借款人，明显是异常值，应该剔除掉。</p>
<pre><code>＃画出x2分布的箱线图
boxplot(traindata_imp$x2)</code></pre><p><img src="https://pic.downk.cc/item/5e86e6cd504f4bcb04ab56a0.png" alt=""><br>    #列举x2的数据<br>    &gt; unique(traindata_imp$x2)<br>     [1]  45  40  38  30  49  74  57  39  27  51  46  76  64  78  53  43  25  32  58  50  69  24  28  62  42  75<br>     [27]  26  52  41  81  31  68  70  73  29  55  35  72  60  67  36  56  37  66  83  34  44  48  61  80  47  59<br>     [53]  77  63  54  33  79  65  86  92  23  87  71  22  90  97  84  82  91  89  85  88  21  93  96  99  94  95<br>     [79] 101  98 103 102 107 105   0 109</p>
<p>剔除样本中x2等于0的异常值</p>
<pre><code>traindata_imp=traindata_imp[-which(traindata_imp$x2==0),]</code></pre><p>此外也可以用boxplot.stats()函数剔除异常值,该函数适用于整体分布较为对称的数据，长尾比较严重的数据不适合，其中默认coef＝1.5,可以适当调整coef值，代码如下</p>
<pre><code>traindata_imp=traindata_imp[-which(traindata_imp$x2 %in% boxplot.stats(traindata_imp$x2,coef = 1.5)$out),]</code></pre><p>剔除完x2的异常值后，同样观察x3、x7、x9的箱线图，发现三个变量靠近100的区域有两个异常值</p>
<pre><code>boxplot(traindata_imp$x3,traindata_imp$x7,traindata_imp$x9,names = c(&apos;x3&apos;,&apos;x7&apos;,&apos;x9&apos;))</code></pre><p><img src="https://pic.downk.cc/item/5e86e6cd504f4bcb04ab56a4.png" alt=""></p>
<p>剔除x3、x7、x9的异常值</p>
<pre><code>traindata_imp=traindata_imp[-which(traindata_imp$x3&gt;95|traindata_imp$x7&gt;95|traindata_imp$x9&gt;95),]</code></pre><p>x4的原始变量名为DebtRatio(负债比率，即全部负债与全部资产的比率)，会计学有个公式：<strong><code>资产＝负债＋所有者权益</code></strong>，而<strong><code>负债比率=负债／资产＊100％</code></strong>，所有者权益&gt;=0,所以负债比例应该不大于1,剔除掉x4中大于1的异常值</p>
<pre><code>traindata_imp=traindata_imp[-which(traindata_imp$x4&gt;1),]</code></pre><p>观察剩余变量x5、x6、x8、x10，无明确异常值故不做处理。</p>
<h3 id="四-变量分析"><a href="#四-变量分析" class="headerlink" title="(四)变量分析"></a>(四)变量分析</h3><p>逻辑回归模型需要检验各变量之间是否存在多重共线性问题，通过corrplot()可以打印出各变量两两之间的相关性，可以看到各变量之间的相关性都比较小，之后建模时还可以用VIF来检验多重共线性的问题。</p>
<pre><code>cor1&lt;-cor(traindata_imp[,2:12])
library(corrplot)
corrplot(cor1,method = &quot;number&quot;)</code></pre><p><img src="https://pic.downk.cc/item/5e86e6cd504f4bcb04ab56a7.png" alt=""></p>
<h3 id="五-变量筛选"><a href="#五-变量筛选" class="headerlink" title="(五)变量筛选"></a>(五)变量筛选</h3><p>使用createDataPartition将样本分隔成70%的训练集和30%的测试集，通过p值控制分割的比例。</p>
<pre><code>set.seed(100) 
splitIndex&lt;-createDataPartition(traindata_imp$y,time=1,p=0.7,list=FALSE) 
train&lt;-traindata_imp[splitIndex,] 
test&lt;-traindata_imp[-splitIndex,] </code></pre><p>查看原样本、训练集、测试集中目标变量y的分布，可以看到好坏分布基本一致。</p>
<pre><code>&gt; prop.table(table(traindata_imp$y))
         0          1 
0.93359856 0.06640144 
&gt; prop.table(table(train$y))
         0          1 
0.93393158 0.06606842 
&gt; prop.table(table(test$y))
        0         1 
0.9328215 0.0671785 </code></pre><p>建立逻辑回归模型</p>
<pre><code>fit=glm(y~.,data = train[,-1],family = binomial(link = &apos;logit&apos;))
#查看模型结果
summary(fit)</code></pre><p>建立逻辑回归模型，查看模型结果，结果如下,可以知道x1的p值&gt;0.05,未通过检验：</p>
<pre><code>&gt; summary(fit)
Call:
glm(formula = y ~ ., family = binomial(link = &quot;logit&quot;), data = train[, 
    -1])

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.6971  -0.3370  -0.2770  -0.2216   3.6352  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.191e+00  6.663e-02 -32.883  &lt; 2e-16 ***
x1          -4.556e-05  9.275e-05  -0.491 0.623281    
x2          -2.423e-02  1.254e-03 -19.313  &lt; 2e-16 ***
x3           5.440e-01  1.506e-02  36.134  &lt; 2e-16 ***
x4           1.039e+00  8.401e-02  12.369  &lt; 2e-16 ***
x5          -1.062e-05  4.111e-06  -2.584 0.009774 ** 
x6          -8.819e-03  3.822e-03  -2.308 0.021022 *  
x7           8.815e-01  2.364e-02  37.296  &lt; 2e-16 ***
x8          -7.468e-02  2.061e-02  -3.623 0.000291 ***
x9           7.092e-01  3.221e-02  22.020  &lt; 2e-16 ***
x10          6.217e-02  1.314e-02   4.732 2.23e-06 ***
---
Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 39050  on 80234  degrees of freedom
Residual deviance: 31787  on 80224  degrees of freedom
AIC: 31809

Number of Fisher Scoring iterations: 6</code></pre><p>去除x1后重现建模，公式如下    </p>
<pre><code>fit2=glm(y ~ x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10,data = train[,-1],family = binomial(link = &apos;logit&apos;))</code></pre><p>查看新建模型，结果如下，所有变量的p值都通过检验</p>
<pre><code>&gt; summary(fit2)

Call:
glm(formula = y ~ x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10, 
    family = binomial(link = &quot;logit&quot;), data = train[, -1])

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.6973  -0.3371  -0.2770  -0.2217   3.6384  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.191e+00  6.663e-02 -32.887  &lt; 2e-16 ***
x2          -2.422e-02  1.254e-03 -19.309  &lt; 2e-16 ***
x3           5.441e-01  1.506e-02  36.137  &lt; 2e-16 ***
x4           1.039e+00  8.401e-02  12.364  &lt; 2e-16 ***
x5          -1.067e-05  4.112e-06  -2.595 0.009470 ** 
x6          -8.788e-03  3.821e-03  -2.300 0.021467 *  
x7           8.816e-01  2.363e-02  37.299  &lt; 2e-16 ***
x8          -7.467e-02  2.061e-02  -3.622 0.000292 ***
x9           7.093e-01  3.221e-02  22.021  &lt; 2e-16 ***
x10          6.220e-02  1.314e-02   4.735  2.2e-06 ***
---
Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 39050  on 80234  degrees of freedom
Residual deviance: 31788  on 80225  degrees of freedom
AIC: 31808

Number of Fisher Scoring iterations: 6</code></pre><p>对各变量进行VIF多重共线性检验(当0&lt;VIF&lt;10，不存在多重共线性；当10≤VIF&lt;100，存在较强的多重共线性；当VIF≥100，存在严重多重共线性),可以看到各变量之间不存在多重共线性。</p>
<pre><code>&gt; vif(fit2)
      x2       x3       x4       x5       x6       x7       x8       x9      x10 
1.109821 1.103973 1.630034 1.430896 1.457423 1.116286 1.841333 1.104896 1.057597 </code></pre><p>通过测试集检验逻辑回归模型的效果，评估模型效果一般用ROC曲线，ROC横轴为特异率，纵轴为敏感度，代码如下</p>
<pre><code>#用模型对测试集进行预测
test$lg_p &lt;-predict(fit2,test)
test$p &lt;-1/(1+exp(-1*test$lg_p))
#画出模型的ROC曲线
library(pROC)
modelroc &lt;- roc(test$y,test$p)
plot(modelroc, print.auc=TRUE, auc.polygon=TRUE, grid=c(0.1, 0.2),
     grid.col=c(&quot;green&quot;, &quot;red&quot;), max.auc.polygon=TRUE,
     auc.polygon.col=&quot;skyblue&quot;, print.thres=TRUE)</code></pre><p>AUC（Area Under Curve）被定义为ROC曲线下的面积，显然这个面积的数值不会大于1，又由于ROC曲线一般都处于y=x这条直线的上方，所以AUC的取值范围在0.5和1之间，AUC越接近于1模型预测效果越好。</p>
<p>可以看到，本模型的AUC为0.808，说明该模型预测效果较为不错。</p>
<p><img src="https://pic.downk.cc/item/5e86e6ce504f4bcb04ab56aa.png" alt=""></p>
<p>经过上述过程，最后经过筛选后最后进入信用评分卡模型的变量为 x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10 。</p>
<h3 id="六-对变量进行WOE转换"><a href="#六-对变量进行WOE转换" class="headerlink" title="(六)对变量进行WOE转换"></a>(六)对变量进行WOE转换</h3><p>WOE称为证据权重(Weight of Evidence),计算公式为：<code>ln(违约件占比／正常件占比)</code>，违约件占比高于正常件时，WOE为负数。WOE的绝对值越高，说明该组别好坏客户的区分能力越强，各组之间的WOE值差距应该尽量拉开。</p>
<h4 id="对变量进行分箱"><a href="#对变量进行分箱" class="headerlink" title="对变量进行分箱"></a>对变量进行分箱</h4><p>R语言中woe()可以对变量自动计算woe值，不过该函数自动分组功能并不好用，所以我们先手动对变量进行分组。</p>
<p>x2、x4、x5、x6为连续变量，用cut()将每个变量分为等深的10组，x2分组代码如下，其它连续变量代码类似。</p>
<pre><code>#x2分成10组
#查看x2变量分布
plot(density(traindata_imp$x2))
#提取x2的十分位数
x2_q=quantile(traindata_imp$x2,probs = seq(0, 1, 0.1),names=FALSE)
#用无穷小和无穷大分别替换最小值和最大值
x2_q[1]=-Inf
x2_q[length(x2_q)]=Inf
#生成分组组号
traindata_imp$x2_rank=cut(traindata_imp$x2,x2_q,labels = F)
#查看分组样本数
table(traindata_imp$x2_rank)</code></pre><p>x3、x7、x8、x9、x10为非连续变量，手动将每个变量分为5组(x9分成4组)，x3分组代码如下，其它非连续变量代码类似。</p>
<pre><code>#x3分成5组 
#查看x3变量分布
table(traindata_imp$x3)
#x3非连续变量，将其分为5组，变量值&gt;=4的样本归为一组
traindata_imp$x3_rank=traindata_imp$x3+1
traindata_imp$x3_rank[which(traindata_imp$x3_rank&gt;5)]=5
#查看分组样本数
table(traindata_imp$x3_rank)</code></pre><h4 id="计算各分组WOE值"><a href="#计算各分组WOE值" class="headerlink" title="计算各分组WOE值"></a>计算各分组WOE值</h4><p>之前说过本文采用的WOE的计算公式为：<code>ln(违约件占比／正常件占比)</code>，而R语言woe()中WOE值的计算公式为<code>ln(违约件占比／正常件占比)＊100</code>，所以要在woe()的计算结果上在乘以0.01进行转换。</p>
<pre><code>#计算各分组的WOE值
woe_2=woe(Data=traindata_imp,&quot;x2_rank&quot;,FALSE,&quot;y&quot;,5,Bad=0,Good=1)
woe_3=woe(Data=traindata_imp,&quot;x3_rank&quot;,FALSE,&quot;y&quot;,5,Bad=0,Good=1)
woe_4=woe(Data=traindata_imp,&quot;x4_rank&quot;,FALSE,&quot;y&quot;,5,Bad=0,Good=1)
woe_5=woe(Data=traindata_imp,&quot;x5_rank&quot;,FALSE,&quot;y&quot;,5,Bad=0,Good=1)
woe_6=woe(Data=traindata_imp,&quot;x6_rank&quot;,FALSE,&quot;y&quot;,5,Bad=0,Good=1)
woe_7=woe(Data=traindata_imp,&quot;x7_rank&quot;,FALSE,&quot;y&quot;,5,Bad=0,Good=1)
woe_8=woe(Data=traindata_imp,&quot;x8_rank&quot;,FALSE,&quot;y&quot;,5,Bad=0,Good=1)
woe_9=woe(Data=traindata_imp,&quot;x9_rank&quot;,FALSE,&quot;y&quot;,5,Bad=0,Good=1)
woe_10=woe(Data=traindata_imp,&quot;x10_rank&quot;,FALSE,&quot;y&quot;,5,Bad=0,Good=1)</code></pre><p>以woe_2为例，结果中WOE所在的列就是分组对应自动计算出来的WOE值。</p>
<pre><code>&gt; woe_2
   BIN   BAD GOOD TOTAL  BAD% GOOD% TOTAL%    WOE    IV BAD_SPLIT GOOD_SPLIT
1    1 10795 1287 12082 0.101 0.169  0.105   51.5 0.035     0.893      0.107
2    2 10433 1095 11528 0.097 0.144  0.101   39.5 0.019     0.905      0.095
3    3 11339 1114 12453 0.106 0.146  0.109   32.0 0.013     0.911      0.089
4    4 10419  871 11290 0.097 0.114  0.098   16.1 0.003     0.923      0.077
5    5 10900  885 11785 0.102 0.116  0.103   12.9 0.002     0.925      0.075
6    6 10219  740 10959 0.095 0.097  0.096    2.1 0.000     0.932      0.068
7    7  9735  540 10275 0.091 0.071  0.090  -24.8 0.005     0.947      0.053
8    8 11881  516 12397 0.111 0.068  0.108  -49.0 0.021     0.958      0.042
9    9 10457  304 10761 0.098 0.040  0.094  -89.6 0.052     0.972      0.028
10  10 10832  259 11091 0.101 0.034  0.097 -108.9 0.073     0.977      0.023</code></pre><p>提取并转换各分组的WOE值</p>
<pre><code>woe2=woe_2$WOE*0.01
woe3=woe_3$WOE*0.01
woe4=woe_4$WOE*0.01
woe5=woe_5$WOE*0.01
woe6=woe_6$WOE*0.01
woe7=woe_7$WOE*0.01
woe8=woe_8$WOE*0.01
woe9=woe_9$WOE*0.01
woe10=woe_10$WOE*0.01</code></pre><p>对样本进行WOE赋值</p>
<pre><code>traindata_imp$x2_woe=woe2[traindata_imp$x2_rank]
traindata_imp$x3_woe=woe3[traindata_imp$x3_rank]
traindata_imp$x4_woe=woe4[traindata_imp$x4_rank]
traindata_imp$x5_woe=woe5[traindata_imp$x5_rank]
traindata_imp$x6_woe=woe6[traindata_imp$x6_rank]
traindata_imp$x7_woe=woe7[traindata_imp$x7_rank]
traindata_imp$x8_woe=woe8[traindata_imp$x8_rank]
traindata_imp$x9_woe=woe9[traindata_imp$x9_rank]
traindata_imp$x10_woe=woe10[traindata_imp$x10_rank]    </code></pre><p>以上就是对各变量进行WOE转换的全部过程。</p>
<h3 id="七-评分卡设定"><a href="#七-评分卡设定" class="headerlink" title="(七)评分卡设定"></a>(七)评分卡设定</h3><p>标准评分卡采用的格式是评分卡中的每一个变量都遵循一系列IF-THEN法则，变量的值决定了该变量所分配的分值，总分就是各变量分值的和。</p>
<pre><code>信用评分公式为：Score=A-Bln(odds)
                A为基础分
                B为权重值 
                odds=p/(1-p),即为坏好比，坏好比越高，score越低
                ln(odds)=(b0+b1·x1＋b2·x2+……) b0、b1…即为我们要算出的逻辑回归模型的系数</code></pre><p>为了求出A和B，需要下面两个设定：</p>
<ul>
<li>当odds＝1:1时，设定score＝500分；</li>
<li>当odds＝1:2时，设定score＝530分；(每提高30分，坏好比降低一半)</li>
</ul>
<p>500分和30分坏好比降一半这两个设定可以根据自身的要求自己调整。这两个设定就给了我们两个公式：</p>
<ul>
<li>500=A-Bln(1/1)</li>
<li>530=A-Bln(1/2)</li>
</ul>
<p>可以计算得到<code>A=500, B=43.28085</code></p>
<h3 id="八-计算各变量分数"><a href="#八-计算各变量分数" class="headerlink" title="(八)计算各变量分数"></a>(八)计算各变量分数</h3><h4 id="计算WOE转化后的各变量的系数"><a href="#计算WOE转化后的各变量的系数" class="headerlink" title="计算WOE转化后的各变量的系数"></a>计算WOE转化后的各变量的系数</h4><pre><code>#生成训练集和测试集
train&lt;-traindata_imp[splitIndex,] 
test&lt;-traindata_imp[-splitIndex,]     
#建立逻辑回归模型
fit3=glm(y ~ x2_woe + x3_woe + x4_woe + x5_woe + x6_woe + x7_woe + x8_woe + x9_woe + x10_woe,data = train[,-1],family = binomial(link = &apos;logit&apos;))
summary(fit3)
#将变量参数赋给coe
coe = fit3$coefficients</code></pre><h4 id="计算各变量的分数"><a href="#计算各变量的分数" class="headerlink" title="计算各变量的分数"></a>计算各变量的分数</h4><p>1、计算基础分数：</p>
<pre><code>A=500
B=30/log(2)
base_score=A-B*coe[1]</code></pre><p>2、计算训练集各变量的信用评分：</p>
<pre><code>train$x2_score=(-1)*B*train$x2_woe*coe[2]
train$x3_score=(-1)*B*train$x3_woe*coe[3]
train$x4_score=(-1)*B*train$x4_woe*coe[4]
train$x5_score=(-1)*B*train$x5_woe*coe[5]
train$x6_score=(-1)*B*train$x6_woe*coe[6]
train$x7_score=(-1)*B*train$x7_woe*coe[7]
train$x8_score=(-1)*-B*train$x8_woe*coe[8]
train$x9_score=(-1)*B*train$x9_woe*coe[9]
train$x10_score=(-1)*B*train$x10_woe*coe[10]</code></pre><p>3、计算训练集各观测样本的总分，总评分＝基础分＋各变量分数和。</p>
<pre><code>train$score=base_score+train$x2_score+train$x3_score+train$x4_score+train$x5_score+train$x6_score+train$x7_score+train$x8_score+train$x9_score+train$x10_score</code></pre><p>4、同样的，计算测试集各变量的信用评分：</p>
<pre><code>test$x2_score=(-1)*B*test$x2_woe*coe[2]
test$x3_score=(-1)*B*test$x3_woe*coe[3]
test$x4_score=(-1)*B*test$x4_woe*coe[4]
test$x5_score=(-1)*B*test$x5_woe*coe[5]
test$x6_score=(-1)*B*test$x6_woe*coe[6]
test$x7_score=(-1)*B*test$x7_woe*coe[7]
test$x8_score=(-1)*-B*test$x8_woe*coe[8]
test$x9_score=(-1)*B*test$x9_woe*coe[9]
test$x10_score=(-1)*B*test$x10_woe*coe[10]</code></pre><p>5、计算测试集各观测样本的总分：</p>
<pre><code>test$score=base_score+test$x2_score+test$x3_score+test$x4_score+test$x5_score+test$x6_score+test$x7_score+test$x8_score+test$x9_score+test$x10_score
summary(test$score)</code></pre><h3 id="九-打印评分卡"><a href="#九-打印评分卡" class="headerlink" title="(九)打印评分卡"></a>(九)打印评分卡</h3><p>需要先将各个变量的实际变量变化范围和信用评分组合在一起，代码如下，其它变量代码一致：</p>
<pre><code>x2_s=tapply(train$x2_score,train$x2_rank,max)
x2_t=tapply(train$x2,train$x2_rank,range)
names(x2_s)=x2_t</code></pre><p>最后将各变量评分规则合并成一个list：</p>
<pre><code>score_list=list(x2=x2_s,x3=x3_s,x4=x4_s,x5=x5_s,x6=x6_s,x7=x7_s,x8=x8_s,x9=x9_s,x10=x10_s)</code></pre><p>最后把评分卡打印出来，每个变量的区间下面对应着这个区间的信用评分：</p>
<pre><code>&gt; score_list
$x2
  c(21, 32)   c(33, 38)   c(39, 43)   c(44, 47)   c(48, 51)   c(52, 55)   c(56, 59)   c(60, 64)   c(65, 71)  c(72, 102) 
-13.0443064 -10.0048563  -8.1052001  -4.0779288  -3.2674088  -0.5319038   6.2815301  12.4110876  22.6945602  27.5830090 

$x3
  c(0, 0)   c(1, 1)   c(2, 2)   c(3, 3)  c(4, 13) 
 14.84904 -24.81542 -45.98320 -55.89214 -71.37305 

$x4
          c(0, 0.013594562) c(0.013597281, 0.090909091)  c(0.09092792, 0.159954299) c(0.159956689, 0.219178082) 
                 20.8327762                  -0.4528864                   1.8568344                   5.2081940 
c(0.219180026, 0.275072557)  c(0.27507641, 0.333288895) c(0.333296177, 0.399334443) c(0.399336476, 0.483461963) 
                 10.5522540                  10.0087903                   2.8078959                  -2.2191435 
c(0.483471394, 0.621075785)           c(0.621126291, 1) 
                -12.8166862                 -22.8707651 

$x5
       c(0, 2400)     c(2401, 3208)     c(3209, 4000)     c(4001, 4800)     c(4801, 5563)     c(5564, 6500)     c(6501, 7700) 
       -5.0877876        -5.9124137        -3.1429147        -2.8628530        -0.3267387         0.9490980         3.2829455 
    c(7701, 9282)    c(9283, 11880) c(11881, 1794060) 
        5.2122595         6.7681578         6.7681578 

$x6
    c(0, 3)     c(4, 4)         5:6     c(7, 7)     c(8, 8)     c(9, 9)   c(10, 10)       11:12   c(13, 15)   c(16, 57) 
-12.8976555  -0.3313627   1.3254508   3.9763523   8.6409194   3.1352008   3.6704790   3.0587325   2.2175811   1.0960458 

$x7
   c(0, 0)    c(1, 1)    c(2, 2)    c(3, 3)   c(4, 17) 
  10.68024  -55.38219  -73.26872  -85.26963 -105.91234 

$x8
  c(0, 0)   c(1, 1)   c(2, 2)   c(3, 3)  c(4, 29) 
 6.644972 -5.523458 -6.364594 -2.803786 10.009515 

$x9
   c(0, 0)    c(1, 1)    c(2, 2)   c(3, 11) 
  5.197519 -34.669594 -51.021340 -64.861925 

$x10
  c(0, 0)   c(1, 1)   c(2, 2)   c(3, 3)  c(4, 20) 
 3.582490 -1.529603 -3.985017 -5.937273 -9.278247 </code></pre><h2 id="三、评分卡模型评估指标"><a href="#三、评分卡模型评估指标" class="headerlink" title="三、评分卡模型评估指标"></a>三、评分卡模型评估指标</h2><p>一般信用评分卡模型评估指标大致可以分成两类：</p>
<ul>
<li>一类是预测能力指标，表示模型对违约事件的预测能力，如AUC、K-S指标、GINI系数和分离度；</li>
<li>一类是稳定性指标，表示模型在训练样本和测试样本中预测能力的一致性，如roc.test和PSI指标。</li>
</ul>
<h3 id="一-ROC曲线"><a href="#一-ROC曲线" class="headerlink" title="(一)ROC曲线"></a>(一)ROC曲线</h3><p>ROC曲线上面已经介绍过了，主要通过AUC来衡量模型的预测能力，AUC越接近1模型预测效果越好。</p>
<pre><code>r1=roc(train$y1,train$score, plot=TRUE, print.thres=F, print.auc=F,col=&quot;3&quot;,lwd=5)  
r2=roc(test$y1,test$score, plot=TRUE, print.thres=TRUE, print.auc=TRUE,add=TRUE,col=&quot;1&quot;)  
legend(&quot;bottomright&quot;, legend=c(&quot;train&quot;, &quot;test&quot;), col=c(&quot;3&quot;, &quot;1&quot;), lwd=2)</code></pre><p><img src="https://pic.downk.cc/item/5e86e6d4504f4bcb04ab5dda.png" alt=""><br>roc.test可以用来比较训练样本和测试样本的roc是否一致，p-value&gt;0.05说明两者一致。</p>
<pre><code>&gt; roc.test(r1,r2)

    DeLong&apos;s test for two ROC curves

data:  r1 and r2
D = 0.85911, df = 65072, p-value = 0.3903
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.8123469   0.8071067</code></pre><h3 id="二-K-S指标"><a href="#二-K-S指标" class="headerlink" title="(二)K-S指标"></a>(二)K-S指标</h3><p>K-S指标主要是测量违约和正常用户分布的最大差距，按分数顺序分别画出违约用户和正常用户的累积百分比线图，两者之间的最大差距值就是K-S指标。计算公式为<code>max（正常用户累计－违约用户累计）</code>，K-S指标越大表示模型的区分能力越强。</p>
<pre><code>pred_Tr&lt;-prediction(train$score,train$y1)
tpr&lt;-performance(pred_Tr,measure=&apos;tpr&apos;)@y.values[[1]]
fpr&lt;-performance(pred_Tr,measure=&apos;fpr&apos;)@y.values[[1]]
ks&lt;-(tpr-fpr)
depth&lt;-performance(pred_Tr,measure=&apos;rpp&apos;)@y.values[[1]]
plot(depth,ks,type=&apos;l&apos;,main=&apos;train k-s&apos;,ylab=&apos;ks&apos;,xlab=&apos;depth&apos;,ylim=c(0,1))
lines(depth,tpr,col=&apos;2&apos;)
lines(depth,fpr,col=&apos;3&apos;)
kslable&lt;-c(paste(&quot;KS:&quot;,round(max(ks),3),sep=&quot;&quot;),paste(&quot;tpr:&quot;,round(tpr[which(ks==max(ks))],3),sep=&quot;&quot;),paste(&quot;fpr:&quot;,round(fpr[which(ks==max(ks))],3),sep=&quot;&quot;))
legend(0.0,1.0,c(kslable),bty=&quot;n&quot;,ncol = 1)
legend(0.4,1.0,legend=c(&quot;TPR&quot;, &quot;FPR&quot;,&quot;TPR-FPR&quot;), col=c(&quot;2&quot;, &quot;3&quot;,&quot;1&quot;),cex=0.6,lwd=2)</code></pre><p><img src="https://pic.downk.cc/item/5e86e6d4504f4bcb04ab5ddd.png" alt=""></p>
<p><img src="https://pic.downk.cc/item/5e86e6d4504f4bcb04ab5ddf.png" alt=""></p>
<h3 id="三-基尼系数"><a href="#三-基尼系数" class="headerlink" title="(三)基尼系数"></a>(三)基尼系数</h3><p>GINI系数是正常用户累计百分比与违约用户累计百分比通过模型选择与随机选择时的差值，对角线下面的那条红色曲线也叫洛伦兹曲线，对角线表示完全没有好坏区分能力的随记选择结果，两者之间的区域除以对角线以下的面积即为GINI系数，GINI系数越大表示模型区分能力越强。</p>
<pre><code>pred_Tr&lt;-prediction(train$score,train$y1)
fnr&lt;-performance(pred_Tr,measure=&apos;fnr&apos;)@y.values[[1]] #FN/(FN+TP)=FN/P
tnr&lt;-performance(pred_Tr,measure=&apos;tnr&apos;)@y.values[[1]] #TN/(TN+FP)=TN/N
plot(tnr,fnr,type=&apos;l&apos;,main=&apos;train_Gini&apos;,xlab=&apos;x-tnr&apos;,ylab=&apos;y-fnr&apos;,yaxs=&quot;i&quot;,xaxs=&quot;i&quot;,col=2)
abline(a=0,b=1,col=1)
kslable1&lt;-paste(&quot;Gini:&quot;,round(Gini(fnr),3),sep=&quot;&quot;)
legend(0.5,0.5,c(kslable1),bty=&quot;n&quot;,ncol = 1)
legend(&quot;bottomright&quot;, legend=c(&quot;RandomSelection&quot;, &quot;ModelPick&quot;), col=c(&quot;1&quot;, &quot;2&quot;), cex=0.75,lwd=2)</code></pre><p><img src="https://pic.downk.cc/item/5e86e6d4504f4bcb04ab5de8.png" alt=""><br><img src="https://pic.downk.cc/item/5e86e6d4504f4bcb04ab5deb.png" alt=""></p>
<h3 id="四-分离度指标"><a href="#四-分离度指标" class="headerlink" title="(四)分离度指标"></a>(四)分离度指标</h3><p>分离度主要是基于评分的好坏用户的整体分布的差别，通常分离度越高，评分模型的排序能力越强，计算公式如下图所示：<br><img src="https://pic.downk.cc/item/5e86e6db504f4bcb04ab64ab.png" alt=""></p>
<pre><code>train_s0=train$score[train$y==0]
train_s1=train$score[train$y==1]
plot(density(train_s0),main =&quot;train_divergence&quot;,col=1)
lines(density(train_s1),col=2)
divergence=((mean(train_s0)-mean(train_s1))^2)/(0.5*(var(train_s0)+var(train_s1)))
kslable&lt;-paste(&quot;divergence:&quot;,round(divergence,3),sep=&quot;&quot;)
legend(400,0.013,c(kslable),bty=&quot;n&quot;,ncol = 1)
legend(350,0.017, legend=c(&quot;Goods&quot;, &quot;Bads&quot;), col=c(&quot;1&quot;, &quot;2&quot;), cex=0.75,lwd=2)</code></pre><p><img src="https://pic.downk.cc/item/5e86e6db504f4bcb04ab649b.png" alt=""><br><img src="https://pic.downk.cc/item/5e86e6db504f4bcb04ab649e.png" alt=""></p>
<h3 id="五-稳定度指标PSI"><a href="#五-稳定度指标PSI" class="headerlink" title="(五)稳定度指标PSI"></a>(五)稳定度指标PSI</h3><p>PSI的计算公式为：<code>sum(（实际占比-预期占比）* ln(实际占比/预期占比))</code>,实际占比就是各分数组在测试集的占比，预期占比就是各分数组在训练集的占比。一般认为psi小于0.1时候模型稳定性很高，0.1-0.25一般，大于0.25模型稳定性差，建议重做。</p>
<pre><code>#提取train$score的十分位数
score_q=quantile(train$score,probs = seq(0, 1, 0.1),names=FALSE)
#用无穷小和无穷大分别替换最小值和最大值
score_q[1]=-Inf
score_q[length(score_q)]=Inf
#生成分组组号
train$score_rank=cut(train$score,score_q,labels = F)
test$score_rank=cut(test$score,score_q,labels = F)
#计算PSI
a=b=c=0
for(i in 1:10){
  a=sum(train$score_rank==i)/length(train$score);
  b=sum(test$score_rank==i)/length(test$score);
  c=c+(b-a)*log(b/a);
}
#画出分布图
plot(density(train$score),main=&apos;PSI&apos;,col=2,lwd=5)
lines(density(test$score),col=1,lwd=2)
kslable&lt;-paste(&quot;PSI:&quot;,round(c,5),sep=&quot;&quot;)
legend(400,0.013,c(kslable),bty=&quot;n&quot;,ncol = 1)
legend(350,0.017, legend=c(&quot;train&quot;, &quot;test&quot;), col=c(&quot;2&quot;, &quot;1&quot;), cex=0.75,lwd=2)</code></pre><p><img src="https://pic.downk.cc/item/5e86e6db504f4bcb04ab64a3.png" alt=""></p>
<h2 id="附录：参考文献"><a href="#附录：参考文献" class="headerlink" title="附录：参考文献"></a>附录：参考文献</h2><ul>
<li><a href="http://blog.csdn.net/csqazwsxedc/article/details/51225156" target="_blank" rel="noopener">信用卡评分模型(R语言)_程松</a></li>
<li>《互联网金融时代消费信贷评分建模与应用》_单良,茆小林</li>
<li>《SAS开发经典案例解析》_杨池然</li>
<li><a href="http://m.blog.csdn.net/article/details?id=46975985" target="_blank" rel="noopener">Scorecard 评分卡模型_textboy</a></li>
</ul>
<blockquote>
<p>版权声明：本文为大枫原创文章，转载请注明来源。</p>
</blockquote>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="https://pic.downk.cc/item/5e86f540504f4bcb04b71ea8.jpg" alt="大枫 微信支付"/>
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E9%A1%B9%E7%9B%AE/" rel="tag"># 机器学习项目</a>
          
            <a href="/tags/%E4%BF%A1%E7%94%A8%E8%AF%84%E5%88%86%E5%8D%A1/" rel="tag"># 信用评分卡</a>
          
            <a href="/tags/R%E8%AF%AD%E8%A8%80/" rel="tag"># R语言</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/03/02/CART%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0_%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80/" rel="next" title="CART算法实现_基于R语言">
                <i class="fa fa-chevron-left"></i> CART算法实现_基于R语言
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">大枫</p>
              <p class="site-description motion-element" itemprop="description">这是最好的时代，也是最坏的时代</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、项目简述"><span class="nav-number">1.</span> <span class="nav-text">一、项目简述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一-项目目标"><span class="nav-number">1.1.</span> <span class="nav-text">(一)项目目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二-数据来源"><span class="nav-number">1.2.</span> <span class="nav-text">(二)数据来源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三-数据说明"><span class="nav-number">1.3.</span> <span class="nav-text">(三)数据说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、建模过程"><span class="nav-number">2.</span> <span class="nav-text">二、建模过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一-数据读入及重命名"><span class="nav-number">2.1.</span> <span class="nav-text">(一)数据读入及重命名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二-缺失值处理"><span class="nav-number">2.2.</span> <span class="nav-text">(二)缺失值处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三-异常值处理"><span class="nav-number">2.3.</span> <span class="nav-text">(三)异常值处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四-变量分析"><span class="nav-number">2.4.</span> <span class="nav-text">(四)变量分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#五-变量筛选"><span class="nav-number">2.5.</span> <span class="nav-text">(五)变量筛选</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#六-对变量进行WOE转换"><span class="nav-number">2.6.</span> <span class="nav-text">(六)对变量进行WOE转换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#对变量进行分箱"><span class="nav-number">2.6.1.</span> <span class="nav-text">对变量进行分箱</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#计算各分组WOE值"><span class="nav-number">2.6.2.</span> <span class="nav-text">计算各分组WOE值</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#七-评分卡设定"><span class="nav-number">2.7.</span> <span class="nav-text">(七)评分卡设定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#八-计算各变量分数"><span class="nav-number">2.8.</span> <span class="nav-text">(八)计算各变量分数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#计算WOE转化后的各变量的系数"><span class="nav-number">2.8.1.</span> <span class="nav-text">计算WOE转化后的各变量的系数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#计算各变量的分数"><span class="nav-number">2.8.2.</span> <span class="nav-text">计算各变量的分数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#九-打印评分卡"><span class="nav-number">2.9.</span> <span class="nav-text">(九)打印评分卡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、评分卡模型评估指标"><span class="nav-number">3.</span> <span class="nav-text">三、评分卡模型评估指标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一-ROC曲线"><span class="nav-number">3.1.</span> <span class="nav-text">(一)ROC曲线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二-K-S指标"><span class="nav-number">3.2.</span> <span class="nav-text">(二)K-S指标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三-基尼系数"><span class="nav-number">3.3.</span> <span class="nav-text">(三)基尼系数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四-分离度指标"><span class="nav-number">3.4.</span> <span class="nav-text">(四)分离度指标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#五-稳定度指标PSI"><span class="nav-number">3.5.</span> <span class="nav-text">(五)稳定度指标PSI</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#附录：参考文献"><span class="nav-number">4.</span> <span class="nav-text">附录：参考文献</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">大枫</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
